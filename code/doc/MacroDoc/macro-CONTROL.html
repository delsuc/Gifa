<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=iso-8859-1">
	<TITLE>Macro programming - CONTROL STRUCTURES</TITLE>
	<META NAME="GENERATOR" CONTENT="StarOffice/5.2 (Win32)">
	<META NAME="CREATED" CONTENT="20011127;17035023">
	<META NAME="CHANGEDBY" CONTENT="Thierry Gostan">
	<META NAME="CHANGED" CONTENT="20011127;17083637">
	<!-- This document was created from RTF source by rtftohtml version 3.9.3 -->
</HEAD>
<BODY>
<P ALIGN=CENTER STYLE="margin-bottom: 0cm"><A HREF="./macro-EVALUATE.html"><IMG SRC="./images/leftg.gif" NAME="Image1" ALT="Prev " ALIGN=BOTTOM WIDTH=30 HEIGHT=29 BORDER=0></A> 
  <A HREF="./macro-SUPPORT.html"><IMG SRC="./images/rightg.gif" NAME="Image2" ALT="Next " ALIGN=BOTTOM WIDTH=30 HEIGHT=29 BORDER=0></A> 
  <A HREF="./macro-Contents.html"><IMG SRC="./images/contg.gif" NAME="Image3" ALT="Contents " ALIGN=BOTTOM WIDTH=30 HEIGHT=29 BORDER=0></A> 
</P>
<HR SIZE=4>
<H1>CONTROL STRUCTURES</H1>
<UL>
	<LI><P STYLE="margin-bottom: 0cm"><A HREF="#Control"><FONT COLOR="#cc0000">Control
	structures</FONT></A></P>
	<UL>
		<LI><P STYLE="margin-bottom: 0cm"><A HREF="#FOR"><FONT COLOR="#cc0000">FOR
		.. ENDFOR</FONT></A></P>
		<LI><P STYLE="margin-bottom: 0cm"><A HREF="#FOREACH"><FONT COLOR="#cc0000">FOREACH
		.. ENDFOR</FONT></A></P>
		<LI><P STYLE="margin-bottom: 0cm"><A HREF="#WHILE"><FONT COLOR="#cc0000">WHILE
		.. ENDWHILE</FONT></A></P>
		<LI><P STYLE="margin-bottom: 0cm"><A HREF="#IF"><FONT COLOR="#cc0000">IF
		.. ELSIF .. ELSE .. ENDIF</FONT></A></P>
		<LI><P STYLE="margin-bottom: 0cm"><A HREF="#GOTO"><FONT COLOR="#cc0000">GOTO</FONT></A></P>
	</UL>
	<LI><P><A HREF="#FIND"><FONT COLOR="#cc0000">FIND, FOREACH - WITHIN</FONT></A></P>
</UL>
<HR SIZE=4>
<H2><A NAME="Control"></A>Control structures</H2>
<P STYLE="margin-bottom: 0cm">	There are several control structures
in the <I>Gifa</I> language. They are all pretty classical, and
should not make you any problems.</P>
<H3><A NAME="FOR"></A>FOR .. ENDFOR</H3>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>FOR var_name = initial TO final {
STEP <I>step</I>}</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>	.. some Gifa code</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>ENDFOR</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm">	This construction permits to write
loops. The variable called <I>var_name</I>, will be created local to
the macro if it does not yet exist, set to the value <I>initial</I>,
and incremented by 1 for each loop. The increment can be different
from 1 (but always numeric) with the optional field STEP <I>step</I>.
<I>step</I> can even be negative, in which case the variable will be
decremented. In any case, the test performed to determine whether the
loop is finished or not is  (<I>var_name</I> &gt; <I>final</I>)   if
step is positive  or  (<I>var_name</I> &lt; <I>final</I>)   if step
is negative.</P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<BR>
</P>
<H3><A NAME="FOREACH"></A>FOREACH .. ENDFOR</H3>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>FOREACH var_name IN array_name</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>	.. some Gifa code</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>ENDFOR</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm">	Equivalent to <FONT FACE="Courier">FOR
.. ENDFOR</FONT>, but here <I>var_name </I>will take successively all
the value possible for an index in the array <I>array_name</I>. Thus
<FONT FACE="Courier">$array_name[$var_name] </FONT>will take all the
value of the array. <I>array_name </I>has to be, either a user
associative array, or a dbm bound array. The array will be accessed
in an apparently random manner,</P>
<P STYLE="margin-bottom: 0cm"><FONT FACE="Courier">FOREACH</FONT>
does not work for context arrays (such as $ZOOM[] ).</P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<H3><A NAME="WHILE"></A>WHILE .. ENDWHILE</H3>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>WHILE some_value_to_be_evaluated</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>	.. some Gifa code</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>ENDWHILE</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm">	The <I>Gifa</I> code will executed as
long as <I>some_value_to_be_evaluated</I> is true (is non zero). The
value to be evaluated can be a variable or a complex evaluated
expression into parentheses.</P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<H3><A NAME="IF"></A>IF .. ELSIF .. ELSE .. ENDIF</H3>
<P STYLE="margin-bottom: 0cm">	The IF command has two distinctive
syntaxes : a complete IF .. THEN construct with ELSIF and ELSE
possibilities and a one-line IF without possible nesting nor else.</P>
<P STYLE="margin-bottom: 0cm">	The multi-line IF is as follow :</P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>IF test THEN</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>..commands on several lines</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>{ ELSIF test2 THEN</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>..commands }   (eventually many
exclusive tests )</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>{ ELSE	  (default case)</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>..commands }</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>ENDIF</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm">	The different commands will executed
conditionally on the value of the tests. Any non-zero value is
considered as true. IF may be nested, with no limit on the number of
nesting.</P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P STYLE="margin-bottom: 0cm">	The one-line IF is as follow :</P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>IF logical_value   ...remaining of
the line ...</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm">	All the commands on the remaining of
the command line are executed only if <I>logical_value</I> holds true
(is non-zero).</P>
<P STYLE="margin-bottom: 0cm">Examples :</P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P STYLE="margin-bottom: 0cm; border-top: 1.00pt solid #000000; border-bottom: 1.00pt solid #000000; border-left: none; border-right: none; padding: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2><I>IF ($X =&lt; 0)  GOTO SKIP</I></FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; border-top: 1.00pt solid #000000; border-bottom: 1.00pt solid #000000; border-left: none; border-right: none; padding: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2><I>print 'Hello' IF ($ITYPE_1D ==
1)    set x = ($x+1) </I></FONT></FONT>
</P>
<P STYLE="margin-bottom: 0cm; border-top: 1.00pt solid #000000; border-bottom: 1.00pt solid #000000; border-left: none; border-right: none; padding: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2><I>IF (!eof(input)) print 'Still
reading the file' \</I></FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; border-top: 1.00pt solid #000000; border-bottom: 1.00pt solid #000000; border-left: none; border-right: none; padding: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2><I>                 set line =
(%+1) \</I></FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; border-top: 1.00pt solid #000000; border-bottom: 1.00pt solid #000000; border-left: none; border-right: none; padding: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2><I>                 IF
($line&lt;$linemax) goto continue</I></FONT></FONT></P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P STYLE="margin-bottom: 0cm">tests to be used are described in the
&#147;evaluated expression&#148; paragraph.</P>
<H3><A NAME="GOTO"></A>GOTO</H3>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>GOTO label</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm">will redirect the execution of the
macro to the symbol =label appearing somewhere else in the same file.</P>
<P STYLE="margin-bottom: 0cm">Example</P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>=loop</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>	...any kind of processing...</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>	goto loop</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm">GOTO should not be used to jump into
FOR FOREACH or WHILE loops, nor into IF .. THEN structures,
Unpredictable execution will occur.</P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P STYLE="margin-bottom: 0cm">	All these commands may be freely
nested. However, except for <FONT FACE="Courier">GOTO</FONT> and the
one-line <FONT FACE="Courier">IF</FONT>, these commands (<FONT FACE="Courier">FOR,
FOREACH, ENDFOR, WHILE, ENDWHILE</FONT>, and <FONT FACE="Courier">=label</FONT>)
should appear alone on one line, with no code preceding nor following
the command (or the label), but eventually followed by a comment.</P>
<H2><A NAME="FIND"></A>FIND, FOREACH - WITHIN</H2>
<P STYLE="margin-bottom: 0cm">	These two commands are meant for
accessing arrays (dbm or plain array) storing coordinate information
such as peaks for instance. The common structure of such arrays will
be that the coordinates have to be stored first in the array.</P>
<P STYLE="margin-bottom: 0cm">Then the <FONT FACE="Courier">FIND</FONT>
command, given an array name, the number of coordinates to search
for, and a target point, will return the index of the closest entry
in the array. Returned values are in the contexts <FONT FACE="Courier">$FND_PK</FONT>
which give the index of the found entry, and in <FONT FACE="Courier">$FND_PK_DST
</FONT>which gives the distance to target. 
</P>
<P STYLE="margin-bottom: 0cm">Let's give two examples of arrays with
coordinates set in the beginning of each entry :</P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P STYLE="margin-bottom: 0cm; border-top: 1.00pt solid #000000; border-bottom: 1.00pt solid #000000; border-left: none; border-right: none; padding: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2><I>SET chem[1] = &quot;1.1
spin_name1&quot;</I></FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; border-top: 1.00pt solid #000000; border-bottom: 1.00pt solid #000000; border-left: none; border-right: none; padding: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2><I>SET chem[2] = &quot;2.5
spin_name2&quot;</I></FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; border-top: 1.00pt solid #000000; border-bottom: 1.00pt solid #000000; border-left: none; border-right: none; padding: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2><I>etc..</I></FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; border-top: 1.00pt solid #000000; border-bottom: 1.00pt solid #000000; border-left: none; border-right: none; padding: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2><I>SET peak[1] = &quot;1.1 1.1
peak_name 1&quot;</I></FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; border-top: 1.00pt solid #000000; border-bottom: 1.00pt solid #000000; border-left: none; border-right: none; padding: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2><I>SET peak[2] = &quot;1.1 2.5
peak_name 2&quot;</I></FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; border-top: 1.00pt solid #000000; border-bottom: 1.00pt solid #000000; border-left: none; border-right: none; padding: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2><I>SET peak[3] = &quot;2.5 3.6
peak_name 2&quot;</I></FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; border-top: 1.00pt solid #000000; border-bottom: 1.00pt solid #000000; border-left: none; border-right: none; padding: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2><I>etc..</I></FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<BR>
</P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>FIND chem 1 1.3</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm">	then <FONT FACE="Courier">$FND_PK</FONT>
is 1 and <FONT FACE="Courier">$FND_PK_DST</FONT> is 0.2</P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>FIND peak 2 1.3 2.2</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm">	then <FONT FACE="Courier">$FND_PK</FONT>
is 2 and <FONT FACE="Courier">$FND_PK_DST</FONT> is 0.36 (Cartesian
distance)</P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P STYLE="margin-bottom: 0cm">With the same kind of array, it is
possible to restrict the scanning performed with the <FONT FACE="Courier">FOREACH</FONT>
command to a given zone :</P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>FOREACH var_name IN array_name
WITHIN dim (range values)</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>	.. some Gifa code</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2>ENDFOR</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm">var_name will only scan the index in
array_name, that fall inside the range given as argument to <FONT FACE="Courier">WITHIN</FONT>.</P>
<P STYLE="margin-bottom: 0cm">Example given using the previous
example</P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P STYLE="margin-bottom: 0cm; border-top: 1.00pt solid #000000; border-bottom: 1.00pt solid #000000; border-left: none; border-right: none; padding: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2><I>FOREACH i IN peak WITHIN 2 1 1 2
3  ; within the 2D square (1,1) to (2,3)</I></FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; border-top: 1.00pt solid #000000; border-bottom: 1.00pt solid #000000; border-left: none; border-right: none; padding: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2><I>	print $peak[$i]</I></FONT></FONT></P>
<P STYLE="margin-bottom: 0cm; border-top: 1.00pt solid #000000; border-bottom: 1.00pt solid #000000; border-left: none; border-right: none; padding: 0cm; line-height: 100%; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Courier"><FONT SIZE=2><I>ENDFOR</I></FONT></FONT></P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P STYLE="margin-bottom: 0cm">will print the value of peak[1] and
peak[2] but not peak[3].</P>
<P STYLE="margin-bottom: 0cm">	These command have been designed for
the assignment module, and you will find many examples of their use
in it.</P>
<HR SIZE=4>
<P ALIGN=CENTER><A HREF="./macro-EVALUATE.html"><IMG SRC="./images/leftg.gif" NAME="Image4" ALT="Prev " ALIGN=BOTTOM WIDTH=30 HEIGHT=29 BORDER=0></A> 
  <A HREF="./macro-SUPPORT.html"><IMG SRC="./images/rightg.gif" NAME="Image5" ALT="Next " ALIGN=BOTTOM WIDTH=30 HEIGHT=29 BORDER=0></A> 
  <A HREF="./macro-Contents.html"><IMG SRC="./images/contg.gif" NAME="Image6" ALT="Contents " ALIGN=BOTTOM WIDTH=30 HEIGHT=29 BORDER=0></A> 
</P>
</BODY>
</HTML>